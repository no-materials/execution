---
id: et-f295
status: open
deps: [et-03b4]
links: []
created: 2026-02-03T16:42:21Z
type: task
priority: 2
assignee: Bruce Mitchener
tags: [vm, trace, cleanup]
---
# VM run loop: reduce program plumbing via per-run refs

`Vm::run` threads `program_ref: &Program` into multiple helper calls (e.g. `ctx.span_at(program_ref, ...)`) and repeats `program.verified(func_id)` lookups.

Tighten the per-run boundary so the loop uses a minimal set of stable references:
- Keep the necessary `&Program` / `&VerifiedProgram` references in locals (or in a small per-run struct) to avoid repeated passing and to make refactoring easier.
- If helpful, add `ExecutionContext` helpers that donâ€™t require passing `&Program` each time (but avoid storing `&mut TraceSink` inside the ctx).

Acceptance:
- No behavior change.
- No lifetime complexity increase.
- Code reads flatter (less indentation / fewer repeated boilerplate blocks).

